{% extends "base.html" %}

{% block title %}Finance - Pretty Saloon{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Finance & Billing</h1>
</div>

<!-- Summary Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white p-6 rounded-lg shadow-md">
        <p class="text-gray-600 text-sm">Total Revenue</p>
        <p class="text-3xl font-bold text-green-600 mt-2">₹{{ "%.2f"|format(total_revenue) }}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
        <p class="text-gray-600 text-sm">Total Transactions</p>
        <p class="text-3xl font-bold text-blue-600 mt-2">{{ total_transactions }}</p>
    </div>
    <div class="bg-white p-6 rounded-lg shadow-md">
        <a href="{{ url_for('download_report', period=period, format='excel') }}" class="block text-center bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
            <i class="fas fa-download mr-2"></i>Download Report
        </a>
    </div>
</div>

<!-- Period Filter -->
<div class="mb-6">
    <div class="flex gap-2">
        <a href="{{ url_for('finance', period='day') }}" class="px-4 py-2 rounded-md {% if period == 'day' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            Today
        </a>
        <a href="{{ url_for('finance', period='week') }}" class="px-4 py-2 rounded-md {% if period == 'week' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            This Week
        </a>
        <a href="{{ url_for('finance', period='month') }}" class="px-4 py-2 rounded-md {% if period == 'month' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            This Month
        </a>
        <a href="{{ url_for('finance', period='year') }}" class="px-4 py-2 rounded-md {% if period == 'year' %}bg-blue-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %}">
            This Year
        </a>
    </div>
</div>

<!-- Transactions Table -->
<div class="bg-white rounded-lg shadow-md overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Invoice #</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% if transactions %}
                {% for transaction in transactions %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ transaction.created_at.strftime('%Y-%m-%d') }}</div>
                        <div class="text-sm text-gray-500">{{ transaction.created_at.strftime('%I:%M %p') }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">{{ transaction.invoice_number }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">{{ transaction.customer.name }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">₹{{ "%.2f"|format(transaction.amount) }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-900">₹{{ "%.2f"|format(transaction.discount) }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-bold text-green-600">₹{{ "%.2f"|format(transaction.total_amount) }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 py-1 text-xs font-semibold rounded-full {% if transaction.payment_status == 'paid' %}bg-green-100 text-green-800{% else %}bg-yellow-100 text-yellow-800{% endif %}">
                            {{ transaction.payment_status|title }}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="{{ url_for('download_invoice', transaction_id=transaction.id) }}" class="text-blue-600 hover:text-blue-900">
                            <i class="fas fa-download mr-1"></i>Invoice
                        </a>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" class="px-6 py-4 text-center text-gray-500">
                        No transactions found for this period.
                    </td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}

